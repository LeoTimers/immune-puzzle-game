<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…ç–«åº”ç­”æ‹¼å›¾å°æ¸¸æˆ</title>
    <style>
        :root {
            --innate-bg: #fff5d7; /* å›ºæœ‰å…ç–«èƒŒæ™¯æ·¡é»„ */
            --adaptive-bg: #e0f4fa; /* é€‚åº”æ€§å…ç–«èƒŒæ™¯æ·¡è“ */
            --arrow-color: #4a5568;
            --correct-color: #48bb78;
            --wrong-color: #f56565;
        }

        body {
            font-family: 'Comic Sans MS', 'YouYuan', sans-serif; /* å¡é€šå­—ä½“é£æ ¼ */
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
        }

        h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        /* --- æ¸¸æˆè¿›åº¦å’Œå¾—åˆ† --- */
        .progress-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 15px;
            background: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .progress-bar {
            flex-grow: 1;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            margin: 0 15px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            width: 0%;
            transition: width 0.5s;
        }
        .score-display {
            font-weight: bold;
            color: #2d3748;
            font-size: 18px;
        }

        /* --- æ¸¸æˆä¸»åŒºåŸŸ --- */
        .game-container {
            display: flex;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 1200px;
            width: 100%;
            position: relative;
            overflow-x: auto;
        }

        /* å·¦ä¾§ç—…åŸä½“è¾“å…¥ */
        .step-start {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 10px;
        }
        .big-arrow {
            font-size: 40px;
            color: #4299e1;
            font-weight: bold;
            margin: 0 10px;
        }

        /* æ ¸å¿ƒå…ç–«åŒºå®¹å™¨ */
        .immune-zone {
            display: flex;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        /* å›ºæœ‰å…ç–«åŒº (é»„è‰²) */
        .innate-zone {
            background-color: var(--innate-bg);
            padding: 20px;
            width: 350px;
            display: flex;
            flex-direction: column;
            border-right: 3px dashed #a0aec0;
            position: relative;
        }
        
        /* å›ºæœ‰å…ç–«åŒºçš„è‡ªç”±æ”¾ç½®åŒº */
        .innate-drop-area {
            flex-grow: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 10px;
            min-height: 300px;
            border: 2px solid transparent;
            transition: all 0.3s;
            border-radius: 8px;
        }
        .innate-drop-area.highlight {
            background-color: rgba(255, 255, 255, 0.5);
            border-color: #ed8936;
        }

        /* é€‚åº”æ€§å…ç–«åŒº (è“è‰²) */
        .adaptive-zone {
            background-color: var(--adaptive-bg);
            padding: 20px;
            width: 450px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 30px; /* Tç»†èƒç»„å’ŒBç»†èƒç»„çš„é—´è· */
        }

        /* ç»†èƒåˆ†åŒ–ç»“æ„ */
        .differentiation-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .parent-cell-col {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .arrows-col {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            height: 100px;
            width: 40px;
            position: relative;
        }
        /* ç»˜åˆ¶åˆ†å‰ç®­å¤´ */
        .split-arrow svg {
            width: 100%;
            height: 100%;
            stroke: var(--arrow-color);
            stroke-width: 2;
            fill: none;
        }
        .child-cells-col {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- é€šç”¨ç»†èƒæ ·å¼ --- */
        .cell {
            width: 70px;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            cursor: grab;
            position: relative;
            transition: transform 0.2s;
            z-index: 10;
        }
        .cell:active {
            cursor: grabbing;
            transform: scale(1.1);
        }
        .cell-graphic {
            width: 50px;
            height: 50px;
            margin-bottom: 5px;
            border-radius: 50%;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            background-size: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white; /* é»˜è®¤ç™½åº• */
            border: 2px solid #333;
        }
        .cell span {
            line-height: 1.1;
            color: #333;
            background: rgba(255,255,255,0.8);
            padding: 2px 4px;
            border-radius: 4px;
        }

        /* å„ç§ç»†èƒçš„ç‰¹å®šæ ·å¼ (CSSç”»å›¾) */
        /* ç—…åŸä½“ */
        .pathogen-graphic { background: #fc8181; border-color: #c53030; position: relative; }
        .pathogen-graphic::after { content:''; position:absolute; width:60%; height:60%; border-radius:50%; background:#feb2b2; }
        /* æ ‘çªçŠ¶ (æ˜Ÿå½¢) */
        .dendritic-graphic { background: #ecc94b; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); border: none; }
        /* ä¸­æ€§ç²’ */
        .neutrophil-graphic { background: #fbb6ce; border-radius: 40% 60% 50% 50%; border-color: #d53f8c; }
        /* è‡ªç„¶æ€ä¼¤ */
        .nk-graphic { background: #68d391; border-color: #2f855a; position: relative;}
        .nk-graphic::before { content: 'â€¢â€¢â€¢'; color: white; font-weight: bold;}
        /* å·¨å™¬ç»†èƒ */
        .macrophage-graphic { background: #f6e05e; border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; border-color: #d69e2e; transform: scale(1.1); }
        /* Tç»†èƒ (è“ç´«ç³») */
        .t-cell-graphic { background: #63b3ed; border-color: #3182ce; }
        .memory-t-graphic { background: #90cdf4; border: 3px double #2b6cb0; }
        .effector-t-graphic { background: #7f9cf5; border-color: #5a67d8; }
        /* Bç»†èƒ (ç²‰çº¢ç³») */
        .b-cell-graphic { background: #f687b3; border-color: #d53f8c; position: relative; }
        .b-cell-graphic::before { content: 'Y'; position: absolute; top: -10px; color: #d53f8c; font-weight: bold;}
        .plasma-graphic { background: #f6ad55; border-radius: 45%; border-color: #dd6b20; } /* æµ†ç»†èƒåƒä¸ªç…è›‹ */
        .memory-b-graphic { background: #fbb6ce; border: 3px double #b83280; }
        
        /* å›ºæœ‰æ·‹å·´æ ·ç»†èƒ */
        .ilc-graphic { background: #4fd1c5; border-color: #285e61; position: relative; }
        .ilc-graphic::before { content: 'ILC'; font-size: 8px; color: white; font-weight: bold; }
        
        /* å›ºæœ‰æ ·æ·‹å·´ç»†èƒ */
        .ill-graphic { background: #9f7aea; border-color: #553c9a; position: relative; }
        .ill-graphic::before { content: 'ILL'; font-size: 8px; color: white; font-weight: bold; }
        
        /* æŠ—ä½“ */
        .antibody-graphic { background: transparent; border: none; box-shadow: none; font-size: 30px; color: #3182ce; font-weight: bold; }

        /* --- æŒ–ç©ºæ§½ä½æ ·å¼ --- */
        .slot {
            width: 70px;
            height: 70px;
            background-color: rgba(0,0,0,0.05);
            border: 2px dashed #a0aec0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 5px;
            transition: all 0.3s;
        }
        .slot::before {
            content: '?';
            font-size: 20px;
            color: #cbd5e0;
            font-weight: bold;
        }
        .slot.hovered {
            background-color: #e6fffa;
            border-color: #38b2ac;
            transform: scale(1.05);
        }
        .slot.filled {
            border-style: solid;
            background: transparent;
        }
        .slot.filled::before { content: none; }
        
        /* æ­£ç¡®/é”™è¯¯çš„åé¦ˆåŠ¨ç”» */
        @keyframes shake {
            0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); }
        }
        .wrong-feedback {
            animation: shake 0.4s;
            border-color: var(--wrong-color) !important;
        }
        .correct-feedback {
            border-color: var(--correct-color) !important;
            box-shadow: 0 0 10px var(--correct-color);
        }

        /* --- åº•éƒ¨æ—¶é—´è½´ --- */
        .timeline-container {
            width: 100%;
            max-width: 1200px;
            margin-top: 20px;
            position: relative;
            padding-top: 10px;
        }
        .timeline-arrow {
            width: 100%;
            height: 30px;
            background: linear-gradient(to right, #63b3ed, #4299e1);
            clip-path: polygon(0% 20%, 98% 20%, 98% 0%, 100% 50%, 98% 100%, 98% 80%, 0% 80%);
            margin-bottom: 5px;
        }
        .timeline-labels {
            display: flex;
            justify-content: space-between;
            width: 85%; /* å¯¹é½ä¸Šæ–¹ä¸¤ä¸ªåŒºåŸŸçš„å¤§è‡´æ¯”ä¾‹ */
            font-weight: bold;
            color: #4a5568;
            padding-left: 50px; /* åç§»ä¸€ç‚¹ */
        }

        /* --- æ‹¼å›¾é€‰é¡¹åŒº --- */
        .options-dock {
            margin-top: 30px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 1000px;
            min-height: 120px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
            border: 2px solid #e2e8f0;
        }
        .options-dock h3 {
            width: 100%;
            text-align: center;
            margin-top: 0;
            color: #718096;
            font-size: 16px;
        }

        /* èƒœåˆ©å¼¹çª— */
        .win-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            z-index: 100;
            text-align: center;
            border: 5px solid #f6ad55;
        }
        .win-modal h2 { color: #ed8936; font-size: 30px;}
        .win-modal button {
            background: #48bb78;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* æ’’èŠ±ç‰¹æ•ˆ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0.7;
            z-index: 9999;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <h1>âš”ï¸ å…ç–«åº”ç­”å¤§ä½œæˆ˜ ğŸ›¡ï¸</h1>
    <p style="color: #718096; font-size: 14px;">è¯·å°†åº•éƒ¨çš„å…ç–«ç»†èƒæ‹–åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®ï¼</p>
    
    <!-- æ¸¸æˆè¿›åº¦å’Œå¾—åˆ† -->
    <div class="progress-container">
        <div>æ‹¼å›¾è¿›åº¦:</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="score-display">å¾—åˆ†: <span id="score">0</span>/100</div>
    </div>

    <div class="game-container">
        <!-- 1. ç—…åŸä½“åŒº -->
        <div class="step-start">
            <div class="cell">
                <div class="cell-graphic pathogen-graphic"></div>
                <span>ç—…åŸä½“</span>
            </div>
            <div class="cell" style="margin-top: 10px">
                <div class="cell-graphic pathogen-graphic"></div>
            </div>
        </div>
        <div class="big-arrow">â¡</div>

        <!-- 2. æ ¸å¿ƒå…ç–«åŒº -->
        <div class="immune-zone">
            
            <!-- å›ºæœ‰å…ç–« -->
            <div class="innate-zone">
                <h4 style="text-align: center; color: #d69e2e; margin: 0 0 10px 0;">å›ºæœ‰å…ç–«å±éšœ</h4>
                <!-- æ¨¡æ‹Ÿä¸Šçš®ç»†èƒå±éšœ -->
                <div style="position: absolute; left: 10px; top: 60px; bottom: 60px; width: 20px; display: flex; flex-direction: column; gap: 2px;">
                   <div style="flex:1; background:#ed8936; border-radius: 4px; opacity: 0.6;"></div>
                   <div style="flex:1; background:#ed8936; border-radius: 4px; opacity: 0.6;"></div>
                   <div style="flex:1; background:#ed8936; border-radius: 4px; opacity: 0.6;"></div>
                   <div style="flex:1; background:#ed8936; border-radius: 4px; opacity: 0.6;"></div>
                   <div style="flex:1; background:#ed8936; border-radius: 4px; opacity: 0.6;"></div>
                </div>

                <!-- å›ºæœ‰å…ç–«ç»†èƒæ”¾ç½®åŒº (æ¨¡ç³Šåˆ¤æ–­åŒº) -->
                <div class="innate-drop-area" id="innate-area" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <!-- è¿™é‡Œä¸æ”¾å…·ä½“æ’æ§½ï¼Œåªè¦æ‹–è¿›æ¥æ˜¯å›ºæœ‰å…ç–«ç»†èƒå°±ç®—å¯¹ -->
                    <div style="grid-column: span 2; text-align: center; color: #a0aec0; font-size: 12px; padding-top: 100px; pointer-events: none;">
                        å°† å›ºæœ‰å…ç–«ç»†èƒ<br>æ‹–å…¥æ­¤åŒºåŸŸ
                    </div>
                </div>
            </div>

            <!-- é€‚åº”æ€§å…ç–« -->
            <div class="adaptive-zone">
                
                <!-- Tç»†èƒé€šè·¯ -->
                <div class="differentiation-group">
                    <div class="parent-cell-col">
                        <!-- æŒ–ç©ºï¼šTç»†èƒ -->
                        <div class="slot" id="slot-t-cell" data-answer="t-cell" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                        <span style="font-size:12px; color:#4a5568;">Tç»†èƒ</span>
                    </div>
                    <div class="arrows-col">
                        <div class="split-arrow">
                            <svg viewBox="0 0 40 100" preserveAspectRatio="none">
                                <path d="M0,50 C20,50 20,20 40,20" stroke-dasharray="40 0" fill="none" marker-end="url(#arrowhead)"/>
                                <path d="M0,50 C20,50 20,80 40,80" stroke-dasharray="40 0" fill="none" marker-end="url(#arrowhead)"/>
                                <defs>
                                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                      <polygon points="0 0, 10 3.5, 0 7" fill="#4a5568" />
                                    </marker>
                                </defs>
                            </svg>
                        </div>
                    </div>
                    <div class="child-cells-col">
                        <!-- æŒ–ç©ºï¼šè®°å¿†Tç»†èƒ -->
                        <div class="slot" id="slot-mem-t" data-answer="memory-t" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                        <!-- æŒ–ç©ºï¼šæ•ˆåº”Tç»†èƒ -->
                        <div class="slot" id="slot-eff-t" data-answer="effector-t" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    </div>
                </div>

                <!-- Bç»†èƒé€šè·¯ -->
                <div class="differentiation-group">
                    <div class="parent-cell-col">
                        <!-- æŒ–ç©ºï¼šBç»†èƒ -->
                        <div class="slot" id="slot-b-cell" data-answer="b-cell" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                        <span style="font-size:12px; color:#4a5568;">Bç»†èƒ</span>
                    </div>
                    <div class="arrows-col">
                        <div class="split-arrow">
                            <svg viewBox="0 0 40 100" preserveAspectRatio="none">
                                <path d="M0,50 C20,50 20,20 40,20" stroke-dasharray="40 0" fill="none" marker-end="url(#arrowhead)"/>
                                <path d="M0,50 C20,50 20,80 40,80" stroke-dasharray="40 0" fill="none" marker-end="url(#arrowhead)"/>
                            </svg>
                        </div>
                    </div>
                    <div class="child-cells-col">
                        <!-- æŒ–ç©ºï¼šæµ†ç»†èƒ -->
                        <div style="display:flex; align-items:center;">
                            <div class="slot" id="slot-plasma" data-answer="plasma" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                            <span style="font-size:20px; color:#3182ce; margin-left:5px;">â†’ Y</span> <!-- ç®€å•çš„æŠ—ä½“ç¤ºæ„ -->
                        </div>
                        <!-- æŒ–ç©ºï¼šè®°å¿†Bç»†èƒ -->
                        <div class="slot" id="slot-mem-b" data-answer="memory-b" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    </div>
                </div>

            </div>
        </div>

        <div class="big-arrow">â¡</div>
        <!-- 3. æ¸…é™¤ç—…åŸä½“ -->
        <div class="step-end" style="text-align:center">
            <div style="position:relative; width: 80px; height: 80px;">
                <div class="cell-graphic pathogen-graphic" style="position:absolute; top:0; left:0; opacity: 0.5;"></div>
                <div class="cell-graphic pathogen-graphic" style="position:absolute; top:20px; left:25px; opacity: 0.5;"></div>
                <div style="position:absolute; top:0; left:0; width:100%; height:100%; font-size: 60px; color: #e53e3e; line-height: 80px;">âŒ</div>
            </div>
            <span style="font-size:14px; font-weight:bold; color:#2d3748">æ¸…é™¤ç—…åŸä½“</span>
        </div>

    </div>

    <!-- æ—¶é—´è½´ -->
    <div class="timeline-container">
        <div class="timeline-arrow"></div>
        <div class="timeline-labels">
            <span style="color: #d69e2e;">å›ºæœ‰å…ç–« (æ•°åˆ†é’Ÿè‡³æ•°æ—¥)</span>
            <span style="color: #3182ce;">é€‚åº”æ€§å…ç–« (æ•°æ—¥å)</span>
        </div>
    </div>

    <!-- æ‹¼å›¾é€‰é¡¹å -->
    <div class="options-dock" id="options-dock" ondrop="dropBack(event)" ondragover="allowDrop(event)">
        <h3>ğŸ§© ç»†èƒä»“åº“ (æ‹–æ‹½ä¸‹æ–¹ç»†èƒå¡«ç©º)</h3>
        
        <!-- å›ºæœ‰å…ç–«ç»„ (IDå‰ç¼€ innate-) -->
        <div class="cell" draggable="true" ondragstart="drag(event)" id="innate-dendritic">
            <div class="cell-graphic dendritic-graphic"></div>
            <span>æ ‘çªçŠ¶ç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="innate-neutrophil">
            <div class="cell-graphic neutrophil-graphic"></div>
            <span>ä¸­æ€§ç²’ç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="innate-nk">
            <div class="cell-graphic nk-graphic"></div>
            <span>è‡ªç„¶æ€ä¼¤ç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="innate-macrophage">
            <div class="cell-graphic macrophage-graphic"></div>
            <span>å·¨å™¬ç»†èƒ</span>
        </div>
        <!-- å›ºæœ‰æ·‹å·´æ ·ç»†èƒ -->
        <div class="cell" draggable="true" ondragstart="drag(event)" id="innate-ilc">
            <div class="cell-graphic ilc-graphic"></div>
            <span>å›ºæœ‰æ·‹å·´æ ·ç»†èƒ</span>
        </div>
        <!-- å›ºæœ‰æ ·æ·‹å·´ç»†èƒ -->
        <div class="cell" draggable="true" ondragstart="drag(event)" id="innate-ill">
            <div class="cell-graphic ill-graphic"></div>
            <span>å›ºæœ‰æ ·æ·‹å·´ç»†èƒ</span>
        </div>

        <!-- é€‚åº”æ€§å…ç–«ç»„ (IDå¯¹åº”data-answer) -->
        <div class="cell" draggable="true" ondragstart="drag(event)" id="t-cell">
            <div class="cell-graphic t-cell-graphic"></div>
            <span>Tç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="b-cell">
            <div class="cell-graphic b-cell-graphic"></div>
            <span>Bç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="effector-t">
            <div class="cell-graphic effector-t-graphic"></div>
            <span>æ•ˆåº”Tç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="memory-t">
            <div class="cell-graphic memory-t-graphic"></div>
            <span>è®°å¿†Tç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="plasma">
            <div class="cell-graphic plasma-graphic"></div>
            <span>æµ†ç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="memory-b">
            <div class="cell-graphic memory-b-graphic"></div>
            <span>è®°å¿†Bç»†èƒ</span>
        </div>

        <!-- å¹²æ‰°é¡¹ -->
        <div class="cell" draggable="true" ondragstart="drag(event)" id="distractor-rbc">
            <div class="cell-graphic" style="background:#fc8181; border-radius:50%; border: 4px solid #e53e3e;"></div>
            <span>çº¢ç»†èƒ</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="distractor-platelet">
            <div class="cell-graphic" style="background:#9ae6b4; border-radius:10px; border: 3px solid #38a169;"></div>
            <span>è¡€å°æ¿</span>
        </div>
        <div class="cell" draggable="true" ondragstart="drag(event)" id="distractor-fibroblast">
            <div class="cell-graphic" style="background:#d6bcfa; border-radius:40% 60% 60% 40%; border: 3px solid #805ad5;"></div>
            <span>æˆçº¤ç»´ç»†èƒ</span>
        </div>
    </div>

    <!-- èƒœåˆ©å¼¹çª— -->
    <div class="win-modal" id="win-modal">
        <h2>ğŸ‰ å®Œç¾! å…ç–«ç³»ç»Ÿé˜²å¾¡æˆåŠŸ!</h2>
        <p>ä½ æˆåŠŸé‡å»ºäº†å…ç–«åº”ç­”è¿‡ç¨‹ã€‚</p>
        <p>æœ€ç»ˆå¾—åˆ†: <span id="final-score">0</span>/100</p>
        <button onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
    </div>

    <script>
        let correctCount = 0;
        const totalRequired = 12; // 6ä¸ªå›ºæœ‰ + 6ä¸ªé€‚åº”æ€§
        let score = 0;
        
        // æ›´æ–°è¿›åº¦å’Œå¾—åˆ†æ˜¾ç¤º
        function updateProgress() {
            const progressFill = document.getElementById('progress-fill');
            const progressPercent = (correctCount / totalRequired) * 100;
            progressFill.style.width = `${progressPercent}%`;
            
            // è®¡ç®—å¾—åˆ†ï¼šæ¯æ­£ç¡®æ”¾ç½®ä¸€ä¸ªç»†èƒå¾—8åˆ†ï¼Œæ»¡åˆ†96ï¼Œå†åŠ 4åˆ†å¥–åŠ±
            score = Math.min(correctCount * 8 + (correctCount === totalRequired ? 4 : 0), 100);
            document.getElementById('score').textContent = score;
        }

        function allowDrop(ev) {
            ev.preventDefault();
            // å¦‚æœæ˜¯ç©ºæ§½ä½ï¼Œæ·»åŠ é«˜äº®æ•ˆæœ
            if(ev.target.classList.contains('slot') || ev.target.id === 'innate-area') {
                ev.target.classList.add('highlight');
            }
        }

        // ç§»é™¤é«˜äº®
        document.addEventListener('dragleave', (ev) => {
             if(ev.target.classList.contains('slot') || ev.target.id === 'innate-area') {
                ev.target.classList.remove('highlight');
            }
        });

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
            ev.dataTransfer.effectAllowed = "move";
        }

        function dropBack(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);
            // å…è®¸æ‹–å›ä»“åº“
            document.getElementById("options-dock").appendChild(draggedElement);
            
            // é‡ç½®çŠ¶æ€ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            draggedElement.style.pointerEvents = "auto";
            
            // å¦‚æœä»æ­£ç¡®ä½ç½®æ‹–å›ï¼Œå‡å°‘è®¡æ•°
            if (draggedElement.dataset.placed === "true") {
                correctCount--;
                updateProgress();
                draggedElement.dataset.placed = "false";
            }
        }

        function drop(ev) {
            ev.preventDefault();
            ev.target.classList.remove('highlight');
            
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);
            var target = ev.target;

            // é€»è¾‘ 1: å›ºæœ‰å…ç–«åŒº (Innate Zone)
            // åªè¦ ID åŒ…å« 'innate' ä¸”ç›®æ ‡æ˜¯ innate-area
            if (target.id === "innate-area" || target.closest('#innate-area')) {
                let dropArea = document.getElementById("innate-area");
                
                if (data.includes("innate")) {
                    // æ­£ç¡®ï¼šæ”¾å…¥å›ºæœ‰å…ç–«åŒº
                    dropArea.appendChild(draggedElement);
                    // ç§»é™¤åŸæ¥çš„æ–‡å­—æç¤º
                    let hint = dropArea.querySelector("div[style*='pointer-events: none']");
                    if(hint) hint.style.display = "none";
                    
                    draggedElement.draggable = false; // é”å®š
                    draggedElement.style.cursor = "default";
                    draggedElement.dataset.placed = "true";
                    correctCount++;
                    updateProgress();
                    checkWin();
                } else {
                    // é”™è¯¯åé¦ˆ
                    dropArea.classList.add("wrong-feedback");
                    setTimeout(() => dropArea.classList.remove("wrong-feedback"), 400);
                }
                return;
            }

            // é€»è¾‘ 2: é€‚åº”æ€§å…ç–«åŒº (ç²¾ç¡®åŒ¹é…)
            if (target.classList.contains("slot")) {
                let requiredId = target.getAttribute("data-answer");
                
                if (data === requiredId) {
                    // æ­£ç¡®
                    target.appendChild(draggedElement);
                    target.classList.add("filled");
                    target.classList.add("correct-feedback");
                    draggedElement.draggable = false;
                    draggedElement.style.cursor = "default";
                    draggedElement.dataset.placed = "true";
                    correctCount++;
                    updateProgress();
                    checkWin();
                } else {
                    // é”™è¯¯
                    target.classList.add("wrong-feedback");
                    setTimeout(() => target.classList.remove("wrong-feedback"), 400);
                }
            }
        }

        function checkWin() {
            // ç®€å•æ£€æŸ¥ï¼šé€‚åº”æ€§å…ç–«æ‰€æœ‰æ’æ§½æ˜¯å¦æœ‰å­å…ƒç´ 
            const slots = document.querySelectorAll('.slot');
            let adaptiveComplete = true;
            slots.forEach(slot => {
                if (slot.children.length === 0) adaptiveComplete = false;
            });

            // æ£€æŸ¥å›ºæœ‰å…ç–«åŒºæ˜¯å¦æœ‰6ä¸ªç»†èƒ
            const innateArea = document.getElementById('innate-area');
            const innateCount = innateArea.querySelectorAll('.cell').length;

            if (adaptiveComplete && innateCount >= 6) {
                setTimeout(() => {
                    document.getElementById('final-score').textContent = score;
                    document.getElementById('win-modal').style.display = 'block';
                    confettiEffect(); // æ’’èŠ±æ•ˆæœ
                }, 500);
            }
        }
        
        // ç®€å•çš„æ’’èŠ±æ•ˆæœ
        function confettiEffect() {
            const colors = ['#f56565', '#ed8936', '#ecc94b', '#48bb78', '#38b2ac', '#4299e1', '#9f7aea', '#ed64a6'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(confetti);
                
                // åŠ¨ç”»
                const animation = confetti.animate([
                    { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
                    { transform: `translateY(${window.innerHeight + 100}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: 2000 + Math.random() * 3000,
                    easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
                });
                
                animation.onfinish = () => confetti.remove();
            }
        }
    </script>
</body>
</html>
    

